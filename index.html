<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#006C45">
    <meta name="description" content="Ù…Ø³Ø§Ø¹Ø¯ Ø£Ø¨Ø´Ø± Ø§Ù„Ø°ÙƒÙŠ Pro - ØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø¹ØµØ±ÙŠØ© Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©">

    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='8' fill='%23006C45'/%3E%3Cpath fill='white' d='M16 6L6 12v6c0 5.5 4.5 10 10 10s10-4.5 10-10v-6l-10-6z'/%3E%3C/svg%3E">

    <title>Ù…Ø³Ø§Ø¹Ø¯ Ø£Ø¨Ø´Ø± Ø§Ù„Ø°ÙƒÙŠ - Innovara</title>

    <!-- Fonts: Almarai for Arabic/Modern UI -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">

    <!-- Icons: RemixIcon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet" />

    <style>
        /* --- Design System --- */
        :root {
            /* Palette - Premium Green & Gold */
            --primary: #006C45;
            --primary-dark: #004D31;
            --primary-light: #E0F2EB;
            --accent: #C69C6D;
            /* Premium Gold */
            --accent-hover: #b08d62;

            /* Neutrals */
            --bg-body: #F3F4F6;
            --bg-surface: #FFFFFF;
            --bg-input: #F9FAFB;

            --text-main: #1F2937;
            --text-secondary: #6B7280;
            --text-light: #9CA3AF;
            --text-white: #FFFFFF;

            /* Feedback */
            --success: #10B981;
            --success-bg: #D1FAE5;
            --warning: #F59E0B;
            --warning-bg: #FEF3C7;
            --error: #EF4444;
            --error-bg: #FEE2E2;

            /* Spacing & Layout */
            --header-height: 70px;
            --sidebar-width: 320px;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 30px;

            /* Shadows */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
            --shadow-float: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* --- Reset & Base --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Almarai', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        button {
            font-family: inherit;
            border: none;
            outline: none;
            cursor: pointer;
        }

        input,
        textarea {
            font-family: inherit;
            border: none;
            outline: none;
        }

        /* --- Layout Grid --- */
        .app-layout {
            display: grid;
            grid-template-columns: var(--sidebar-width) 1fr;
            grid-template-rows: var(--header-height) 1fr;
            height: 100%;
            transition: all 0.3s ease;
        }

        /* --- Header --- */
        .app-header {
            grid-column: 1 / -1;
            background: var(--bg-surface);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            box-shadow: var(--shadow-sm);
            z-index: 50;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Animated Logo Icon */
        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            box-shadow: 0 4px 12px rgba(0, 108, 69, 0.2);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .logo-area:hover .logo-icon {
            transform: rotate(10deg) scale(1.05);
        }

        .app-title h1 {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--primary);
        }

        .app-title span {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: block;
            letter-spacing: 0.5px;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .status-pill {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: var(--primary-light);
            color: var(--primary-dark);
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .lang-btn {
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
        }

        .lang-btn:hover {
            background: var(--bg-body);
            color: var(--primary);
        }

        .mobile-menu-btn {
            display: none;
            /* Desktop default */
            font-size: 1.5rem;
            color: var(--text-main);
            background: none;
        }

        /* --- Sidebar (Services) --- */
        .app-sidebar {
            background: var(--bg-surface);
            border-left: 1px solid rgba(0, 0, 0, 0.05);
            /* LTR/RTL handled by direction logic, here using logical props would be better but keeping simple */
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            transition: transform 0.3s ease;
            z-index: 40;
        }

        .services-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: var(--text-light);
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .service-group {
            margin-bottom: 1rem;
        }

        .service-card {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.9rem;
            background: var(--bg-body);
            border-radius: var(--radius-md);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .service-card:hover {
            background: white;
            box-shadow: var(--shadow-sm);
            border-color: var(--primary-light);
            transform: translateY(-2px);
        }

        .service-icon {
            font-size: 1.2rem;
            color: var(--primary);
            background: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-xs);
        }

        .service-card:hover .service-icon {
            background: var(--primary);
            color: white;
        }

        .service-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-main);
        }

        /* --- Chat Area --- */
        .app-main {
            background: var(--bg-body);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-container {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            scroll-behavior: smooth;
        }

        /* Messages */
        .msg {
            display: flex;
            align-items: flex-end;
            gap: 1rem;
            max-width: 80%;
            animation: slideUp 0.3s ease-out forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        .msg.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .msg.ai {
            align-self: flex-start;
        }

        .msg-avatar {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
        }

        .msg.user .msg-avatar {
            background: var(--accent);
            color: white;
        }

        .msg.ai .msg-avatar {
            background: var(--bg-surface);
            color: var(--primary);
            border: 1px solid var(--primary-light);
        }

        .msg-content {
            padding: 1rem 1.25rem;
            border-radius: var(--radius-lg);
            font-size: 0.95rem;
            line-height: 1.6;
            position: relative;
            box-shadow: var(--shadow-sm);
        }

        .msg.user .msg-content {
            background: var(--primary);
            color: white;
            border-bottom-left-radius: 4px;
            /* RTL aware adjustment needed if directing changes */
            border-bottom-right-radius: var(--radius-lg);
        }

        /* RTL spec for rounded corners */
        html[dir="rtl"] .msg.user .msg-content {
            border-bottom-left-radius: var(--radius-lg);
            border-bottom-right-radius: 4px;
        }

        html[dir="ltr"] .msg.user .msg-content {
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: var(--radius-lg);
        }

        .msg.ai .msg-content {
            background: var(--bg-surface);
            color: var(--text-main);
            border-bottom-right-radius: 4px;
        }

        html[dir="rtl"] .msg.ai .msg-content {
            border-bottom-right-radius: var(--radius-lg);
            border-bottom-left-radius: 4px;
        }

        /* Rich Content Cards */
        .info-card {
            background: var(--bg-input);
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-top: 0.5rem;
            border-right: 4px solid var(--primary);
            /* RTL default */
            font-size: 0.9rem;
        }

        .card-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card-row:last-child {
            border: none;
        }

        .card-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .card-val {
            color: var(--text-main);
            font-weight: 700;
        }

        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .tag {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            background: var(--primary-light);
            color: var(--primary-dark);
            border-radius: 50px;
            font-weight: 600;
        }

        /* Input Area */
        .input-zone {
            background: var(--bg-surface);
            padding: 1.5rem;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.03);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 50;
        }

        .input-wrapper {
            flex: 1;
            background: var(--bg-input);
            border-radius: var(--radius-xl);
            padding: 0.5rem 0.5rem 0.5rem 1.5rem;
            display: flex;
            align-items: center;
            border: 2px solid var(--primary-light);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            /* Added shadow for highlight */
            transition: all 0.2s;
        }

        .input-wrapper:focus-within {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px var(--primary-light);
        }

        .text-input {
            flex: 1;
            background: transparent;
            font-size: 1rem;
            padding: 0.5rem;
            min-height: 24px;
            max-height: 100px;
            resize: none;
            overflow-y: auto;
        }

        .send-btn {
            width: 48px;
            height: 48px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.2s;
            box-shadow: var(--shadow-md);
        }

        .send-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .send-btn:disabled {
            background: var(--text-light);
            transform: none;
            box-shadow: none;
        }

        /* Quick Action Buttons within Chat */
        .quick-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .action-btn {
            background: white;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-lg);
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Animations */
        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.4;
            }

            100% {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            padding: 0.5rem;
        }

        .dot {
            width: 6px;
            height: 6px;
            background: var(--text-light);
            border-radius: 50%;
            animation: bounce 1.2s infinite;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* --- Responsive Design --- */
        @media (max-width: 900px) {
            .app-layout {
                grid-template-columns: 1fr;
            }

            .app-sidebar {
                position: fixed;
                top: var(--header-height);
                bottom: 0;
                right: 0;
                /* RTL default */
                width: 280px;
                transform: translateX(100%);
                box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1);
            }

            html[dir="ltr"] .app-sidebar {
                right: auto;
                left: 0;
                transform: translateX(-100%);
            }

            .app-sidebar.active {
                transform: translateX(0);
            }

            .mobile-menu-btn {
                display: block;
            }
        }

        /* --- Calendar Styles --- */
        .calendar-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 1rem;
            width: 100%;
            max-width: 300px;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin-top: 0.5rem;
        }

        .cal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-weight: 700;
            color: var(--primary);
            font-size: 0.95rem;
        }

        .cal-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            text-align: center;
        }

        .cal-day-name {
            font-size: 0.75rem;
            color: var(--text-light);
            padding-bottom: 0.5rem;
            font-weight: 500;
        }

        .cal-date {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-main);
            width: 32px;
            height: 32px;
            margin: auto;
        }

        .cal-date:hover:not(.empty) {
            background: var(--primary-light);
            color: var(--primary);
        }

        .cal-date.selected {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .cal-date.empty {
            cursor: default;
        }
    </style>
</head>

<body>

    <div class="app-layout">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-area">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">
                    <i class="ri-menu-4-line"></i>
                </button>
                <div class="logo-icon">
                    <i class="ri-government-fill"></i>
                </div>
                <div class="app-title">
                    <h1>Ù…Ø³Ø§Ø¹Ø¯ Ø£Ø¨Ø´Ø± Ø§Ù„Ø°ÙƒÙŠ - Innovara</h1>
                    <span>Absher AI Assistant</span>
                </div>
            </div>

            <div class="header-controls">
                <div class="status-pill">
                    <div class="status-dot"></div>
                    <span>Ù…ØªØµÙ„</span>
                </div>
                <button class="lang-btn" onclick="toggleLanguage()" id="langBtn" title="Change Language">
                    <i class="ri-global-line"></i> EN
                </button>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="app-sidebar" id="sidebar">
            <div class="service-group">
                <div class="services-title"><i class="ri-pass-valid-line"></i> Ø§Ù„Ø¬ÙˆØ§Ø²Ø§Øª</div>
                <div class="service-card" onclick="selectService('Ø¥ØµØ¯Ø§Ø±/ØªØ¬Ø¯ÙŠØ¯ Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±')">
                    <div class="service-icon"><i class="ri-passport-line"></i></div>
                    <div class="service-name">Ø¥ØµØ¯Ø§Ø±/ØªØ¬Ø¯ÙŠØ¯ Ø¬ÙˆØ§Ø²</div>
                </div>
                <div class="service-card" onclick="selectService('ØªØ£Ø´ÙŠØ±Ø© Ø®Ø±ÙˆØ¬ ÙˆØ¹ÙˆØ¯Ø© (Ù…ÙØ±Ø¯Ø©)')">
                    <div class="service-icon"><i class="ri-flight-takeoff-line"></i></div>
                    <div class="service-name">ØªØ£Ø´ÙŠØ±Ø© Ø®Ø±ÙˆØ¬ ÙˆØ¹ÙˆØ¯Ø©</div>
                </div>
            </div>

            <div class="service-group">
                <div class="services-title"><i class="ri-calendar-event-line"></i> Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</div>
                <div class="service-card" onclick="selectService('Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯')">
                    <div class="service-icon"><i class="ri-calendar-check-line"></i></div>
                    <div class="service-name">Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯</div>
                </div>
            </div>

            <div class="service-group">
                <div class="services-title"><i class="ri-user-smile-line"></i> Ø§Ù„Ø£Ø­ÙˆØ§Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠØ©</div>
                <div class="service-card" onclick="selectService('ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©')">
                    <div class="service-icon"><i class="ri-account-box-line"></i></div>
                    <div class="service-name">ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ©</div>
                </div>
                <div class="service-card" onclick="selectService('Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯')">
                    <div class="service-icon"><i class="ri-parent-line"></i></div>
                    <div class="service-name">Ø´Ù‡Ø§Ø¯Ø© Ù…ÙŠÙ„Ø§Ø¯</div>
                </div>
                <div class="service-card" onclick="selectService('Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø±Ø©')">
                    <div class="service-icon"><i class="ri-team-line"></i></div>
                    <div class="service-name">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø±Ø©</div>
                </div>
            </div>

            <div class="service-group">
                <div class="services-title"><i class="ri-car-line"></i> Ø§Ù„Ù…Ø±ÙˆØ±</div>
                <div class="service-card" onclick="selectService('ØªØ¬Ø¯ÙŠØ¯ Ø±Ø®ØµØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©')">
                    <div class="service-icon"><i class="ri-steering-2-line"></i></div>
                    <div class="service-name">ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø±Ø®ØµØ©</div>
                </div>
                <div class="service-card" onclick="selectService('Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù…Ø®Ø§Ù„ÙØ§Øª')">
                    <div class="service-icon"><i class="ri-alarm-warning-line"></i></div>
                    <div class="service-name">Ù…Ø®Ø§Ù„ÙØ§Øª Ù…Ø±ÙˆØ±ÙŠØ©</div>
                </div>
                <div class="service-card" onclick="selectService('ØªØ¬Ø¯ÙŠØ¯ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ±)')">
                    <div class="service-icon"><i class="ri-file-list-2-line"></i></div>
                    <div class="service-name">Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</div>
                </div>
            </div>

            <div class="service-group">
                <div class="services-title"><i class="ri-building-4-line"></i> Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</div>
                <div class="service-card" onclick="selectService('ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© (Ø¹Ù…Ø§Ù„Ø© Ø´Ø±ÙƒØ§Øª)')">
                    <div class="service-icon"><i class="ri-briefcase-line"></i></div>
                    <div class="service-name">ØªØ¬Ø¯ÙŠØ¯ Ø¥Ù‚Ø§Ù…Ø© (Ø´Ø±ÙƒØ§Øª)</div>
                </div>
                <div class="service-card" onclick="selectService('ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© (Ø¹Ù…Ø§Ù„Ø© Ù…Ù†Ø²Ù„ÙŠØ©)')">
                    <div class="service-icon"><i class="ri-home-heart-line"></i></div>
                    <div class="service-name">ØªØ¬Ø¯ÙŠØ¯ Ø¥Ù‚Ø§Ù…Ø© (Ù…Ù†Ø²Ù„ÙŠØ©)</div>
                </div>
            </div>
        </aside>

        <!-- Main Chat -->
        <main class="app-main">
            <div class="chat-container" id="messagesContainer">
                <!-- Welcome Message populated by JS -->
            </div>

            <div class="input-zone">
                <div class="input-wrapper">
                    <input type="text" class="text-input" id="userInput" placeholder="ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ..."
                        autocomplete="off">
                </div>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                    <i class="ri-send-plane-fill"></i>
                </button>
            </div>
        </main>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- Data & Config ---
        const absherServices = {
            'ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©': {
                fee: 39, days: 'ÙÙˆØ±ÙŠ',
                requirements: ['ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©', 'Ø¨ØµÙ…Ø© Ù…Ø³Ø¬Ù„Ø©', 'Ø¹Ù†ÙˆØ§Ù† ÙˆØ·Ù†ÙŠ'],
                questions: ['Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ù‚ÙŠÙˆØ¯ Ø³ÙØ±ØŸ', 'Ù‡Ù„ Ø¹Ù†ÙˆØ§Ù†Ùƒ Ù…Ø­Ø¯Ø«ØŸ']
            },
            'Ø¥ØµØ¯Ø§Ø±/ØªØ¬Ø¯ÙŠØ¯ Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±': {
                fee: '300-600 Ø±ÙŠØ§Ù„', days: '3-5 Ø£ÙŠØ§Ù…',
                requirements: ['Ø¹Ù†ÙˆØ§Ù† ÙˆØ·Ù†ÙŠ (ÙˆØ§ØµÙ„)', 'Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª'],
                questions: [
                    { text: 'Ù‡Ù„ ØªÙ…Ù„Ùƒ Ø¹Ù†ÙˆØ§Ù† ÙˆØ·Ù†ÙŠØŸ', options: ['Ù†Ø¹Ù…', 'Ù„Ø§'] },
                    { text: 'Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (5/10)ØŸ', options: ['5 Ø³Ù†ÙˆØ§Øª', '10 Ø³Ù†ÙˆØ§Øª'] }
                ]
            },
            'ØªØ¬Ø¯ÙŠØ¯ Ø±Ø®ØµØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©': {
                fee: '40/200 Ø±ÙŠØ§Ù„', days: 'ÙÙˆØ±ÙŠ',
                requirements: ['ÙØ­Øµ Ø·Ø¨ÙŠ Ø³Ø§Ø±ÙŠ', 'Ø³Ø¯Ø§Ø¯ Ù…Ø³Ø¨Ù‚'],
                questions: [
                    { text: 'Ù…Ø¯Ø© Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ØŸ', options: ['Ø³Ù†ØªÙŠÙ†', '5 Ø³Ù†ÙˆØ§Øª', '10 Ø³Ù†ÙˆØ§Øª'] },
                    { text: 'Ù‡Ù„ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø·Ø¨ÙŠ Ø¬Ø§Ù‡Ø²ØŸ', options: ['Ù†Ø¹Ù…', 'Ù„Ø§'] }
                ]
            },
            'Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù…Ø®Ø§Ù„ÙØ§Øª': {
                fee: 'Ù…Ø¬Ø§Ù†ÙŠ', days: 'ÙÙˆØ±ÙŠ',
                requirements: ['Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', 'Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©'],
                questions: ['Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…Ø³Ø¯Ø¯Ø© Ø£ÙŠØ¶Ø§Ù‹ØŸ']
            },
            'ØªØ¬Ø¯ÙŠØ¯ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ±)': {
                fee: '100-300 Ø±ÙŠØ§Ù„', days: 'ÙÙˆØ±ÙŠ',
                requirements: ['ÙØ­Øµ Ø¯ÙˆØ±ÙŠ', 'ØªØ£Ù…ÙŠÙ† Ù…Ø±ÙƒØ¨Ø©'],
                questions: ['Ù‡Ù„ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø³Ø§Ø±ÙŠØŸ']
            },
            'Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯': {
                fee: 'Ù…Ø¬Ø§Ù†ÙŠ', days: 'ÙÙˆØ±ÙŠ',
                requirements: ['Ø­Ø³Ø§Ø¨ Ø£Ø¨Ø´Ø± Ù…ÙØ¹Ù„'],
                questions: [
                    { text: 'Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ØŸ', options: ['Ø¬ÙˆØ§Ø²Ø§Øª', 'Ø£Ø­ÙˆØ§Ù„', 'Ù…Ø±ÙˆØ±'] },
                    { text: 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨:', type: 'date' }
                ]
            },
            'Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯': { fee: 'Ù…Ø¬Ø§Ù†ÙŠ', days: '2-4 Ø£ÙŠØ§Ù…', requirements: ['ØªØ¨Ù„ÙŠØº Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰'], questions: ['Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ„ÙˆØ¯ØŸ'] },
            'Ø³Ø¬Ù„ Ø§Ù„Ø£Ø³Ø±Ø©': { fee: 'Ù…Ø¬Ø§Ù†ÙŠ', days: '3-5 Ø£ÙŠØ§Ù…', requirements: ['Ù‡ÙˆÙŠØ© Ø§Ù„Ø£Ø¨'], questions: ['ØªÙˆØµÙŠÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ØŸ'] },
            'ØªØ£Ø´ÙŠØ±Ø© Ø®Ø±ÙˆØ¬ ÙˆØ¹ÙˆØ¯Ø© (Ù…ÙØ±Ø¯Ø©)': { fee: '200 Ø±ÙŠØ§Ù„', days: 'ÙÙˆØ±ÙŠ', requirements: ['Ø³Ø±ÙŠØ§Ù† Ø§Ù„Ø¬ÙˆØ§Ø²', 'ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯'], questions: ['Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù…ØŸ'] },
            'ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© (Ø¹Ù…Ø§Ù„Ø© Ø´Ø±ÙƒØ§Øª)': { fee: '650 Ø±ÙŠØ§Ù„', days: 'ÙÙˆØ±ÙŠ', requirements: ['Ø±Ø®ØµØ© Ø¹Ù…Ù„', 'ØªØ£Ù…ÙŠÙ† Ø·Ø¨ÙŠ'], questions: ['Ø±Ù‚Ù… Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©ØŸ'] },
            'ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© (Ø¹Ù…Ø§Ù„Ø© Ù…Ù†Ø²Ù„ÙŠØ©)': { fee: '600 Ø±ÙŠØ§Ù„', days: 'ÙÙˆØ±ÙŠ', requirements: ['Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„'], questions: ['ØªØ¬Ø¯ÙŠØ¯ Ù„Ø³Ù†Ø© Ø£Ù… Ø³Ù†ØªÙŠÙ†ØŸ'] }
        };

        const keywords = {
            'ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©': ['Ù‡ÙˆÙŠØ©', 'Ø¨Ø·Ø§Ù‚Ø©'],
            'Ø¥ØµØ¯Ø§Ø±/ØªØ¬Ø¯ÙŠØ¯ Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±': ['Ø¬ÙˆØ§Ø²', 'Ø³ÙØ±'],
            'ØªØ¬Ø¯ÙŠØ¯ Ø±Ø®ØµØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©': ['Ø±Ø®ØµØ©', 'Ø³ÙˆØ§Ù‚Ø©', 'Ù‚ÙŠØ§Ø¯Ø©'],
            'Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù…Ø®Ø§Ù„ÙØ§Øª': ['Ù…Ø®Ø§Ù„ÙØ§Øª', 'Ø³Ø§Ù‡Ø±'],
            'ØªØ¬Ø¯ÙŠØ¯ Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ±)': ['Ø§Ø³ØªÙ…Ø§Ø±Ø©', 'Ù…Ø±ÙƒØ¨Ø©']
        };

        let currentLang = 'ar';
        let isProcessing = false;
        let selectedService = null;
        let currentQuestionStep = 0;
        let userAnswers = [];

        // --- UI Functions ---

        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.documentElement.setAttribute('lang', currentLang);
            document.documentElement.setAttribute('dir', currentLang === 'ar' ? 'rtl' : 'ltr');
            document.getElementById('langBtn').innerHTML = currentLang === 'ar' ? '<i class="ri-global-line"></i> EN' : '<i class="ri-global-line"></i> Ø¹Ø±Ø¨ÙŠ';

            // Note: In a real app we would translate content here.
            addSystemMessage(currentLang === 'ar' ? 'ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'Language switched to English (Interface only)');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Add message to chat
        function addMessage(content, type = 'ai', isHtml = false) {
            const container = document.getElementById('messagesContainer');
            const msgDiv = document.createElement('div');
            msgDiv.className = `msg ${type}`;

            // Icon
            const icon = type === 'user' ? '<i class="ri-user-6-fill"></i>' : '<i class="ri-robot-2-line"></i>';

            let innerContent = isHtml ? content : `<p>${content}</p>`;

            msgDiv.innerHTML = `
                <div class="msg-avatar">${icon}</div>
                <div class="msg-content">${innerContent}</div>
            `;

            container.appendChild(msgDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Helper for system notifications
        function addSystemMessage(text) {
            addMessage(`<div style="font-size: 0.85rem; color: var(--text-secondary);"><i class="ri-information-line"></i> ${text}</div>`, 'ai', true);
        }

        function addTypingIndicator() {
            const container = document.getElementById('messagesContainer');
            const id = 'typing-' + Date.now();
            const div = document.createElement('div');
            div.className = 'msg ai';
            div.id = id;
            div.innerHTML = `
                <div class="msg-avatar"><i class="ri-robot-2-line"></i></div>
                <div class="msg-content" style="padding: 0.8rem 1rem;">
                    <div class="typing-dots">
                        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                    </div>
                </div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            return id;
        }

        function removeTypingIndicator(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        // --- Logic ---

        function selectService(serviceName) {
            if (isProcessing) return;
            if (window.innerWidth < 900) toggleSidebar(); // close sidebar on mobile

            selectedService = serviceName;
            addMessage(serviceName, 'user');
            processServiceStart(serviceName);
        }

        function processServiceStart(service) {
            isProcessing = true;
            const typingId = addTypingIndicator();

            setTimeout(() => {
                removeTypingIndicator(typingId);
                const info = absherServices[service];

                if (!info) {
                    addMessage('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø¯Ù…Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.', 'ai');
                    isProcessing = false;
                    return;
                }

                // Service Card Info
                let html = `
                    <div style="font-weight: 700; margin-bottom: 0.5rem; color: var(--primary); font-size: 1.1rem;">
                        ${service}
                    </div>
                    <div class="tag-list" style="margin-bottom: 1rem;">
                        <span class="tag"><i class="ri-money-dollar-circle-line"></i> ${info.fee}</span>
                        <span class="tag"><i class="ri-time-line"></i> ${info.days}</span>
                    </div>
                    <div class="info-card">
                        <div style="margin-bottom: 0.5rem; font-weight: 600;">ğŸ“‹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª:</div>
                        ${info.requirements.map(req => `<div style="display:flex; gap:0.5rem; align-items:center; margin-bottom:0.25rem;"><i class="ri-checkbox-circle-line" style="color:var(--success)"></i> ${req}</div>`).join('')}
                    </div>
                `;

                addMessage(html, 'ai', true);

                // Start Questionnaire
                userAnswers = [];
                currentQuestionStep = 0;

                if (info.questions && info.questions.length > 0) {
                    setTimeout(() => askNextQuestion(service), 600);
                } else {
                    finishService(service);
                }
            }, 800);
        }

        function askNextQuestion(service) {
            const info = absherServices[service];
            if (currentQuestionStep >= info.questions.length) {
                finishService(service);
                return;
            }

            let q = info.questions[currentQuestionStep];
            let options = ['Ù†Ø¹Ù…', 'Ù„Ø§', 'ØºÙŠØ± Ù…ØªØ£ÙƒØ¯']; // Default

            // Check if question is object with specific options or type
            if (typeof q === 'object') {
                if (q.type === 'date') {
                    // Render Calendar
                    const html = `
                       <div style="margin-bottom: 0.5rem;">${q.text}</div>
                       ${renderCalendar(service)}
                   `;
                    addMessage(html, 'ai', true);
                    return;
                }
                options = q.options;
                q = q.text;
            }

            const html = `
                <div style="margin-bottom: 0.5rem;">${q}</div>
                <div class="quick-actions">
                    ${options.map(opt => `<button class="action-btn" onclick="handleQuickReply('${opt}', '${service}')">${opt}</button>`).join('')}
                </div>
            `;
            addMessage(html, 'ai', true);
        }

        function renderCalendar(service) {
            const today = new Date();
            const currentMonth = today.toLocaleString('ar-SA', { month: 'long' });
            const currentYear = today.getFullYear();
            const daysInMonth = new Date(currentYear, today.getMonth() + 1, 0).getDate();
            const firstDay = new Date(currentYear, today.getMonth(), 1).getDay(); // 0 is Sunday

            let daysHtml = '';

            // Empty slots for start of month
            for (let i = 0; i < firstDay; i++) {
                daysHtml += '<div class="cal-date empty"></div>';
            }

            // Days
            for (let i = 1; i <= daysInMonth; i++) {
                daysHtml += `<div class="cal-date" onclick="selectDate(this, ${i}, '${service}')">${i}</div>`;
            }

            return `
                <div class="calendar-card">
                    <div class="cal-header">
                        <i class="ri-arrow-right-s-line" style="cursor:pointer"></i>
                        <span>${currentMonth} ${currentYear}</span>
                        <i class="ri-arrow-left-s-line" style="cursor:pointer"></i>
                    </div>
                    <div class="cal-grid">
                        <div class="cal-day-name">Ø£Ø­Ø¯</div><div class="cal-day-name">Ø¥Ø«Ù†ÙŠÙ†</div>
                        <div class="cal-day-name">Ø«Ù„Ø§Ø«Ø§Ø¡</div><div class="cal-day-name">Ø£Ø±Ø¨Ø¹Ø§Ø¡</div>
                        <div class="cal-day-name">Ø®Ù…ÙŠØ³</div><div class="cal-day-name">Ø¬Ù…Ø¹Ø©</div>
                        <div class="cal-day-name">Ø³Ø¨Øª</div>
                        ${daysHtml}
                    </div>
                </div>
            `;
        }

        function selectDate(el, day, service) {
            // Remove siblings selected
            const all = el.parentElement.querySelectorAll('.cal-date');
            all.forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');

            // Auto submit after slight delay
            setTimeout(() => {
                const dateStr = `2025/08/${day}`; // Mock Date
                handleQuickReply(dateStr, service);
            }, 400);
        }

        function handleQuickReply(answer, service) {
            addMessage(answer, 'user');
            userAnswers.push(answer);
            currentQuestionStep++;
            setTimeout(() => askNextQuestion(service), 600);
        }

        function finishService(service) {
            const typingId = addTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator(typingId);
                const refNo = 'REQ-' + Math.floor(Math.random() * 1000000);

                const html = `
                    <div style="text-align: center; padding: 1rem;">
                        <div style="width: 50px; height: 50px; background: var(--success); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin: 0 auto 1rem auto; box-shadow: var(--shadow-md);">
                            <i class="ri-check-line"></i>
                        </div>
                        <h3 style="margin-bottom: 0.5rem;">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­</h3>
                        <div style="background: var(--bg-input); padding: 0.5rem; border-radius: 8px; font-family: monospace; font-size: 1.2rem; margin: 0.5rem 0; letter-spacing: 2px;">${refNo}</div>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">Ø³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø±Ùƒ Ø¨Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ© Ø¹Ù†Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.</p>
                    </div>
                `;
                addMessage(html, 'ai', true);
                isProcessing = false;
                selectedService = null;
            }, 1500);
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text || isProcessing) return;

            addMessage(text, 'user');
            input.value = '';

            // NLP Simulation (Check for services first)
            const foundService = Object.keys(keywords).find(k =>
                keywords[k].some(kw => text.includes(kw))
            );

            if (foundService) {
                processServiceStart(foundService);
            } else {
                // Determine if we are in static mode (file://) or server mode (http://)
                if (window.location.protocol === 'file:') {
                    setTimeout(() => {
                        addMessage('âš ï¸ <b>ØªÙ†Ø¨ÙŠÙ‡:</b> Ø£Ù†Øª ØªØ³ØªØ®Ø¯Ù… Ø§Ù„Ø§ØµØ¯Ø§Ø± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ (Ø«Ø§Ø¨Øª). Ù„Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø°ÙƒÙŠØ©ØŒ ÙŠØ±Ø¬Ù‰ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… (Node.js).', 'ai', true);
                    }, 600);
                } else {
                    callPerplexityApi(text);
                }
            }
        }

        async function callPerplexityApi(question) {
            const typingId = addTypingIndicator();

            try {
                const response = await fetch('/api/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question })
                });

                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.json();
                removeTypingIndicator(typingId);
                addMessage(data.answer, 'ai');

            } catch (error) {
                console.error('Error:', error);
                removeTypingIndicator(typingId);
                addMessage('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ.', 'ai');
            }
        }

        // Init
        window.addEventListener('load', () => {
            const welcomeHtml = `
                <div style="font-size: 1.1rem; font-weight: 700; margin-bottom: 0.5rem;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø³Ø§Ø¹Ø¯ Ø£Ø¨Ø´Ø± Ø§Ù„Ø°ÙƒÙŠ ğŸ‘‹</div>
                <p>Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø¥Ù†Ø¬Ø§Ø² Ø®Ø¯Ù…Ø§ØªÙƒ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© Ø¨Ø³Ø±Ø¹Ø© ÙˆØ³Ù‡ÙˆÙ„Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø®Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ùˆ Ø£Ø®Ø¨Ø§Ø±ÙŠ Ø¨Ù…Ø§ ØªØ­ØªØ§Ø¬ Ø¥Ù„ÙŠÙ‡.</p>
            `;
            addMessage(welcomeHtml, 'ai', true);
        });

        // Enter key support
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

    </script>
</body>

</html>